"use client";
import React from "react";

function MainComponent() {
  const [videoUrl, setVideoUrl] = React.useState("");
  const playerRef = React.useRef(null);
  const handleMxPlayer = () => {
    const openMx = `intent:${videoUrl}#Intent;package=com.mxtech.videoplayer.ad;end`;
    window.location.href = openMx;
  };
  const handleVlcPlayer = () => {
    const openVlc = `vlc://${videoUrl}`;
    window.location.href = openVlc;
  };
  const handleKmPlayer = () => {
    const openKmplayer = `intent:${videoUrl}#Intent;package=com.kmplayer;end`;
    window.location.href = openKmplayer;
  };
  const handleDownload = () => {
    window.location.href = videoUrl;
  };
  const handleGetFile = () => {
    const regex = /(\d+)\?id=(\d+)&/;
    const match = window.location.href.match(regex);
    if (match) {
      const chatId = "-100" + match[1];
      const messageId = match[2];
      window.location.href = `https://t.me/username?start=file_${messageId}${chatId}`;
    }
  };

  const handleCopyUrl = () => {
    navigator.clipboard
      .writeText(videoUrl)
      .then(() => alert("URL copied to clipboard!"))
      .catch((error) => console.error("Failed to copy URL: ", error));
  };

  React.useEffect(() => {
    const url = new URL(window.location.href);
    const videoId = url.pathname.split("/").pop().split("?")[0];
    const idParam = new URLSearchParams(window.location.search).get("id");
    const hashParam = new URLSearchParams(window.location.search).get("hash");
    const encodedName = encodeURIComponent("filename");
    const downloadlink = `${url.origin}/${videoId}/filename?id=${idParam}&hash=${hashParam}`;
    setVideoUrl(downloadlink);
  }, []);

  return (
    <div className="min-h-screen bg-gradient-to-b from-[#0a0a0a] to-[#1a1a1a]">
      <div className="max-w-[1400px] mx-auto px-6 py-12">
        <h1 className="text-4xl font-bold text-white mb-8 flex items-center">
          <i className="fas fa-play-circle text-[#ff4d4d] mr-3"></i>
          Now Playing
        </h1>

        <div className="aspect-video bg-black rounded-xl overflow-hidden shadow-2xl ring-1 ring-white/10">
          <video
            ref={playerRef}
            className="w-full h-full"
            controls
            crossOrigin="anonymous"
            playsInline
          >
            <source src={videoUrl} type="video/mp4" />
          </video>
        </div>

        <div className="mt-8 flex flex-wrap justify-center gap-3">
          <button
            onClick={handleMxPlayer}
            className="bg-[#2a2a2a] hover:bg-[#3a3a3a] text-white px-6 py-3 rounded-full transition-all duration-200 shadow-lg hover:shadow-xl flex items-center space-x-2 hover:scale-105"
          >
            <i className="fas fa-play text-[#ff4d4d]"></i>
            <span>MX Player</span>
          </button>
          <button
            onClick={handleVlcPlayer}
            className="bg-[#2a2a2a] hover:bg-[#3a3a3a] text-white px-6 py-3 rounded-full transition-all duration-200 shadow-lg hover:shadow-xl flex items-center space-x-2 hover:scale-105"
          >
            <i className="fas fa-play-circle text-[#ff4d4d]"></i>
            <span>VLC</span>
          </button>
          <button
            onClick={handleKmPlayer}
            className="bg-[#2a2a2a] hover:bg-[#3a3a3a] text-white px-6 py-3 rounded-full transition-all duration-200 shadow-lg hover:shadow-xl flex items-center space-x-2 hover:scale-105"
          >
            <i className="fas fa-film text-[#ff4d4d]"></i>
            <span>KM Player</span>
          </button>
          <button
            onClick={handleGetFile}
            className="bg-[#2a2a2a] hover:bg-[#3a3a3a] text-white px-6 py-3 rounded-full transition-all duration-200 shadow-lg hover:shadow-xl flex items-center space-x-2 hover:scale-105"
          >
            <i className="fas fa-file text-[#ff4d4d]"></i>
            <span>Get File</span>
          </button>
          <button
            onClick={handleCopyUrl}
            className="bg-[#2a2a2a] hover:bg-[#3a3a3a] text-white px-6 py-3 rounded-full transition-all duration-200 shadow-lg hover:shadow-xl flex items-center space-x-2 hover:scale-105"
          >
            <i className="fas fa-copy text-[#ff4d4d]"></i>
            <span>Copy URL</span>
          </button>
          <button
            onClick={handleDownload}
            className="bg-[#2a2a2a] hover:bg-[#3a3a3a] text-white px-6 py-3 rounded-full transition-all duration-200 shadow-lg hover:shadow-xl flex items-center space-x-2 hover:scale-105"
          >
            <i className="fas fa-download text-[#ff4d4d]"></i>
            <span>Download</span>
          </button>
        </div>
      </div>
    </div>
  );
}

export default MainComponent;
